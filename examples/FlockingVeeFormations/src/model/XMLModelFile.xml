<?xml version="1.0" encoding="utf-8"?>
<gpu:xmodel xmlns:gpu="http://www.dcs.shef.ac.uk/~paul/XMMLGPU" xmlns="http://www.dcs.shef.ac.uk/~paul/XMML">
  <name>Flocking Vee Formations</name>
  <gpu:environment>
    <gpu:constants>
      <gpu:variable>
        <type>int</type>
        <name>population</name>
        <description>Number of agents to spawn</description>
        <defaultValue>2</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>vision</name>
        <description>The distance of sight of the Turtles</description>
        <defaultValue>10.0f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>FOV</name>
        <description>The field of view for each agent, in degrees, centered at the heading direction</description>
        <defaultValue>120.0f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>obstruction_angle</name>
        <description>The angle span from which an agent considers its vision obstructed</description>
        <defaultValue>45.0f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>speed</name>
        <description>Units traveled every iteration</description>
        <defaultValue>0.2f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>speed_change</name>
        <description>Factor that determines the change in speed for the birds</description>
        <defaultValue>0.15f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>updraft_distance</name>
        <description>Distance under which a bird can take from the upwash of another bird</description>
        <defaultValue>4.0f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>minimum_separation</name>
        <description>The distance from witch Turtles are considered separated</description>
        <defaultValue>1.6f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>max_turn</name>
        <description>The rotation capability of a Turtle in one iteration, in degrees</description>
        <defaultValue>4.0f</defaultValue>
      </gpu:variable>
      <gpu:variable>
        <type>float</type>
        <name>bounds</name>
        <description>Dimension of an edge of the world</description>
        <defaultValue>70.0f</defaultValue>
      </gpu:variable>
    </gpu:constants>
    <gpu:functionFiles>
      <file>functions.c</file>
    </gpu:functionFiles>
    <gpu:initFunctions>
      <gpu:initFunction>
        <gpu:name>setup</gpu:name>
      </gpu:initFunction>
    </gpu:initFunctions>
  </gpu:environment>
  <xagents>
    <gpu:xagent>
      <name>turtle</name>
      <description>A single agent of this simulation</description>
      <memory>
        <gpu:variable>
          <type>int</type>
          <name>colour</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>x</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>y</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>heading</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>speed</name>
        </gpu:variable>
      </memory>
      <functions>
        <gpu:function>
          <name>move</name>
          <currentState>default</currentState>
          <nextState>default</nextState>
          <outputs>
            <gpu:output>
              <messageName>position</messageName>
              <gpu:type>single_message</gpu:type>
            </gpu:output>
          </outputs>
          <gpu:reallocate>false</gpu:reallocate>
          <gpu:RNG>false</gpu:RNG>
        </gpu:function>
        <gpu:function>
          <name>flock</name>
          <currentState>default</currentState>
          <nextState>default</nextState>
          <inputs>
            <gpu:input>
              <messageName>position</messageName>
            </gpu:input>
          </inputs>
          <gpu:reallocate>false</gpu:reallocate>
          <gpu:RNG>true</gpu:RNG>
        </gpu:function>
      </functions>
      <states>
        <gpu:state>
          <name>default</name>
        </gpu:state>
        <initialState>default</initialState>
      </states>
      <gpu:type>continuous</gpu:type>
      <gpu:bufferSize>16384</gpu:bufferSize>
    </gpu:xagent>
  </xagents>
  <messages>
    <gpu:message>
      <name>position</name>
      <variables>
        <gpu:variable>
          <type>float</type>
          <name>x</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>y</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>z</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>dx</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>dy</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>heading</name>
        </gpu:variable>
        <gpu:variable>
          <type>float</type>
          <name>speed</name>
        </gpu:variable>
      </variables>
      <gpu:partitioningSpatial>
        <gpu:radius>10</gpu:radius>
        <gpu:xmin>0</gpu:xmin>
        <gpu:xmax>70</gpu:xmax>
        <gpu:ymin>0</gpu:ymin>
        <gpu:ymax>70</gpu:ymax>
        <gpu:zmin>-5</gpu:zmin>
        <gpu:zmax>5</gpu:zmax>
      </gpu:partitioningSpatial>
      <gpu:bufferSize>32768</gpu:bufferSize>
    </gpu:message>
  </messages>
  <layers>
    <layer>
      <gpu:layerFunction>
        <name>move</name>
      </gpu:layerFunction>
    </layer>
    <layer>
      <gpu:layerFunction>
        <name>flock</name>
      </gpu:layerFunction>
    </layer>
  </layers>
</gpu:xmodel>
